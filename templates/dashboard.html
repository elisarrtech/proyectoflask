<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Dashboard - Admin Chatbots</title>
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.5/font/bootstrap-icons.css"
    rel="stylesheet"
  />
</head>
<body>

  <nav class="navbar navbar-expand-lg navbar-dark bg-primary">
    <div class="container-fluid">
      <a class="navbar-brand" href="#">Admin Chatbots</a>
      <button
        class="navbar-toggler"
        type="button"
        data-bs-toggle="collapse"
        data-bs-target="#navbarNav"
        aria-controls="navbarNav"
        aria-expanded="false"
        aria-label="Toggle navigation"
      >
        <span class="navbar-toggler-icon"></span>
      </button>
      <div class="collapse navbar-collapse" id="navbarNav">
        <ul class="navbar-nav ms-auto">
          <li class="nav-item">
            <a class="nav-link active" href="/dashboard">
              <i class="bi bi-speedometer2"></i> Dashboard
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="/nuevo">
              <i class="bi bi-plus-circle"></i> Nuevo Bot
            </a>
          </li>
          <li class="nav-item">
            <a class="nav-link" href="#">
              <i class="bi bi-box-arrow-right"></i> Salir
            </a>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <main class="container my-5">

    <!-- Mensajes flash -->
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for category, message in messages %}
          <div class="alert alert-{{category}} alert-dismissible fade show" role="alert">
            {{ message }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    <h1 class="mb-4">Panel de Control</h1>
    <p class="lead">Lista de chatbots personalizados:</p>

    <table class="table table-striped table-hover shadow-sm">
      <thead class="table-primary">
        <tr>
          <th>Nombre</th>
          <th>Descripción</th>
          <th>Acciones</th>
        </tr>
      </thead>
      <tbody>
        {% for bot in chatbots %}
        <tr>
          <td>{{ bot.nombre }}</td>
          <td>{{ bot.descripcion }}</td>
          <td>
            <a href="{{ url_for('editar', bot_id=bot.id) }}" class="btn btn-sm btn-info me-1">
              <i class="bi bi-pencil"></i> Editar
            </a>
            <button
              type="button"
              class="btn btn-sm btn-danger"
              data-bs-toggle="modal"
              data-bs-target="#confirmDeleteModal"
              data-botname="{{ bot.nombre }}"
              data-botid="{{ bot.id }}"
            >
              <i class="bi bi-trash"></i> Borrar
            </button>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </main>

  <!-- Modal borrar -->
  <div
    class="modal fade"
    id="confirmDeleteModal"
    tabindex="-1"
    aria-labelledby="confirmDeleteModalLabel"
    aria-hidden="true"
  >
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="confirmDeleteModalLabel">Confirmar borrado</h5>
          <button
            type="button"
            class="btn-close"
            data-bs-dismiss="modal"
            aria-label="Cerrar"
          ></button>
        </div>
        <div class="modal-body">
          ¿Seguro que quieres borrar <strong id="botNameToDelete"></strong>?
        </div>
        <div class="modal-footer">
          <form method="POST" action="/borrar">
            <input type="hidden" id="botIdToDelete" name="bot_id" value="" />
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
              Cancelar
            </button>
            <button type="submit" class="btn btn-danger">Borrar</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script>
    var confirmDeleteModal = document.getElementById('confirmDeleteModal')
    confirmDeleteModal.addEventListener('show.bs.modal', function (event) {
      var button = event.relatedTarget
      var botName = button.getAttribute('data-botname')
      var botId = button.getAttribute('data-botid')

      var modalTitle = confirmDeleteModal.querySelector('#botNameToDelete')
      var modalInput = confirmDeleteModal.querySelector('#botIdToDelete')

      modalTitle.textContent = botName
      modalInput.value = botId
    })
  </script>

</body>
</html>


